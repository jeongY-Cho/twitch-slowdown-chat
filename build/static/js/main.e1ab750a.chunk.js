(this["webpackJsonptwitch-chat-counter"]=this["webpackJsonptwitch-chat-counter"]||[]).push([[0],{12:function(e,t,n){e.exports=n(19)},17:function(e,t,n){},18:function(e,t,n){},19:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),s=n(10),o=n.n(s),c=(n(17),n(5)),r=n(1),l=n(2),h=n(3),m=n(4),u=n(11),d=n(8),p=new(function(){function e(){Object(r.a)(this,e),this.subs=[]}return Object(l.a)(e,[{key:"add",value:function(e){this.subs.push(e)}},{key:"publish",value:function(e){var t,n=Object(u.a)(this.subs);try{for(n.s();!(t=n.n()).done;){(0,t.value)(e)}}catch(a){n.e(a)}finally{n.f()}}}]),e}()),f=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.2;Object(r.a)(this,e),this.maxSize=t,this.expireAfter=n,this.top=a,this.threshold=i,this.freqDict={},this.count=0,this.matcher=new d.a([],{includeScore:!0,threshold:this.threshold,ignoreLocation:!0})}return Object(l.a)(e,[{key:"add",value:function(e){var t=this;if(""!==e){var n=this.matcher.search(e)[0];n&&(e=n.item),this.count<this.maxSize?this.freqDict[e]?(this.freqDict[e]++,setTimeout((function(){t.windDown(e)}),this.expireAfter),this.printHead()):(this.freqDict[e]=1,this.matcher.add(e),this.count++,setTimeout((function(){t.windDown(e)}),this.expireAfter),this.printHead()):this.freqDict[e]&&(this.freqDict[e]++,setTimeout((function(){t.windDown(e)}),this.expireAfter),this.printHead())}}},{key:"windDown",value:function(e){this.freqDict[e]&&(this.freqDict[e]--,this.freqDict[e]||(this.matcher.remove((function(t){return t===e})),this.count--,delete this.freqDict[e])),this.printHead()}},{key:"printHead",value:function(){var e=this,t=Object.keys(this.freqDict).sort((function(t,n){return e.freqDict[n]-e.freqDict[t]})).slice(0,this.top).map((function(t){return[t,e.freqDict[t]]}));p.publish(t)}},{key:"changeThreshold",value:function(e){e!==this.threshold&&(this.threshold=e,this.matcher=new d.a(Object.keys(this.freqDict),{includeScore:!0,threshold:this.threshold,ignoreLocation:!0}))}}]),e}(),g=function(){function e(t){var n=this;Object(r.a)(this,e),this.options=t,this.ledger=new f(this.options.max_size),this.socket=void 0,this.socket=new WebSocket("wss://irc-ws.chat.twitch.tv:443"),this.socket.onopen=function(){n.socket.send("PASS oauth:".concat(n.options.token)),n.socket.send("NICK ".concat(n.options.username)),n.socket.send("JOIN #".concat(n.options.channel.toLowerCase()))},this.socket.onmessage=function(t){var a=t.data;a.toString().match("PING :tmi.twitch.tv")&&(console.log(a),n.socket.send("PONG: tmi.twitch.tv"));try{var i=e.cleanString(a.toString().split(":")[2].replace(/\r|\n/g,""));n.ledger.add(i)}catch(s){console.error(s),console.log(a)}}}return Object(l.a)(e,[{key:"connectToChannel",value:function(e){this.socket.send("PART #".concat(this.options.channel)),this.socket.send("JOIN #".concat(e.toLowerCase())),this.options.channel=e}}],[{key:"cleanString",value:function(e){return e.replace(/(\b\S+\b)(?=.*\1)/gi,"").replace(/!.+|@.+/gi,"").replace(/ +/g," ").toLowerCase().trim()}}]),e}(),v=(n(18),function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return(e=t.call.apply(t,[this].concat(i))).client=void 0,e.state={accessParms:{},msgs:[["Connect to a channel on the left",1]],sensitivity:.2,timeSpan:30,showTop:20,connected:!1,channel:"",changed:!1},e.connectToChat=function(t){e.client?e.client.connectToChannel(t):(console.log("connecting to ",t),e.client=new g({channel:t,max_size:1e3,token:e.state.accessParms.access_token,username:"abc"}),p.add((function(t){e.setState({msgs:t})})))},e.changeSettings=function(t){t.preventDefault(),e.client&&(e.client.ledger.top=e.state.showTop,e.client.ledger.expireAfter=1e3*e.state.timeSpan,e.client.ledger.changeThreshold(e.state.sensitivity)),e.setState({changed:!1})},e.onFormChange=function(t){var n;console.log(t.target.name,t.target.value),e.setState((n={},Object(c.a)(n,t.target.name,t.target.value),Object(c.a)(n,"changed",!0),n))},e.channelChange=function(t){e.setState({channel:t.target.value})},e}return Object(l.a)(n,[{key:"componentDidMount",value:function(){console.log(y()),this.setState({accessParms:y()})}},{key:"render",value:function(){var e=this,t=this.state,n=t.accessParms,a=t.msgs;return n.access_token?i.a.createElement("div",{style:{height:"100vh",width:"100vw",display:"flex",justifyContent:"space-evenly",alignItems:"center"}},i.a.createElement("div",null,i.a.createElement("form",{style:{marginBottom:10},onSubmit:function(t){t.preventDefault(),e.connectToChat(e.state.channel)}},i.a.createElement("div",{className:"form-group"},i.a.createElement("label",{htmlFor:"channelName"},"Connect to Channel:"),i.a.createElement("input",{className:"form-control",type:"text",placeholder:"Channel Name",value:this.state.channel,name:"channel",onChange:this.channelChange})),i.a.createElement("button",{className:"btn btn-primary",type:"submit",disabled:!this.state.channel},"Connect to ",this.state.channel)),i.a.createElement("form",{className:"",onSubmit:this.changeSettings},i.a.createElement("div",{className:"form-group"},i.a.createElement("label",{htmlFor:"sensitivity"},"Sensitivity: ",this.state.sensitivity),i.a.createElement("input",{type:"range",name:"sensitivity",id:"sensitivity",className:"custom-range",min:0,max:1,step:.1,value:this.state.sensitivity,onChange:this.onFormChange}),i.a.createElement("small",{id:"sensitivityHelp",className:"form-text text-muted"},"Text matching will match more exactly as sensitivity decreases.")),i.a.createElement("div",{className:"form-group"},i.a.createElement("label",{htmlFor:"Show Top n"},"Show top ",this.state.showTop," comments:"),i.a.createElement("input",{type:"range",className:"custom-range",name:"showTop",id:"Show Top n",min:2,max:40,step:1,value:this.state.showTop,onChange:this.onFormChange}),i.a.createElement("small",{id:"showTopHelp",className:"form-text text-muted"},"Increase to see more chat messages.")),i.a.createElement("div",{className:"form-group"},i.a.createElement("label",{htmlFor:"Time Span"},"Count over ",this.state.timeSpan," seconds:"),i.a.createElement("input",{className:"custom-range",type:"range",name:"timeSpan",id:"Time Span",min:2,max:60,value:this.state.timeSpan,onChange:this.onFormChange}),i.a.createElement("small",{id:"timeSpanHelp",className:"form-text text-muted"},"Increase to count messages over a longer time.")),i.a.createElement("button",{className:this.state.changed?"btn btn-primary":"btn btn-secondary",type:"submit",disabled:!this.state.changed},"Change Settings"))),i.a.createElement("div",{style:{width:"30vw"}},i.a.createElement("table",null,i.a.createElement("colgroup",null,i.a.createElement("col",{style:{width:20}})),i.a.createElement("thead",null),i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("th",null),i.a.createElement("th",null,"Chat")),a.map((function(e,t){return i.a.createElement("tr",{key:t},i.a.createElement("td",null,e[1]),i.a.createElement("td",null,e[0]))})))))):i.a.createElement(w,null)}}]),n}(i.a.Component)),w=function(){return i.a.createElement("div",{style:{height:"100vh",width:"100vw",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},i.a.createElement("div",{className:"jumbotron",style:{marginBottom:50}},i.a.createElement("h1",null,"Twitch Chat Counter"),i.a.createElement("p",null,"This is a simple app that groups similar chat messages and counts the number of chat messages over some distinct length of time."),i.a.createElement("p",null,"Use it to quickly poll for opinions of twitch chat or ask twitch chat to pick from choices without resulting to strawpoll."),i.a.createElement("p",null,"Example: ",i.a.createElement("br",null)," Streamer: \"Ok, Twitch Chat. Type '1' for League of Legends or type '2' for Valorant.\"")),i.a.createElement("div",null,i.a.createElement("a",{href:"https://id.twitch.tv/oauth2/authorize?client_id=n2dcw3bkj5qydrsupnwaozwazraw8f&redirect_uri=".concat(document.location.href,"&response_type=token&scope=chat:read"),style:{backgroundColor:"#6441a5",color:"white",padding:10,borderRadius:10}},"Login with Twitch to count chat")))};function y(){for(var e,t={},n=/\+/g,a=/([^&;=]+)=?([^&;]*)/g,i=function(e){return decodeURIComponent(e.replace(n," "))},s=window.location.hash.substring(1);e=a.exec(s);)t[i(e[1])]=i(e[2]);return t}var b=v;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(b,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[12,1,2]]]);
//# sourceMappingURL=main.e1ab750a.chunk.js.map